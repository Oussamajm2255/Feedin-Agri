<div class="login-container" [class.video-loaded]="isVideoLoaded()" [class.video-error]="videoError()">

  <!-- Background video -->
  <video #bgVideo class="video-background" preload="auto" playsinline muted *ngIf="!videoError()">
    <source [src]="config.assets.loginVideo" type="video/mp4">
  </video>

  <!-- Glassmorphism overlay -->
  <div class="glass-overlay"></div>

  <!-- Back to Landing Button -->
  <button class="back-to-landing" routerLink="/"
    [attr.aria-label]="languageService.t()('auth.backToHome') || 'Back to Home'">
    <mat-icon>home</mat-icon>
    <span>{{ languageService.t()('auth.backToHome') || 'Home' }}</span>
  </button>

  <!-- Login card -->
  <mat-card #loginCard class="login-card" [@fadeInDown] [attr.data-state]="isCardActive() ? 'active' : 'passive'"
    [class.shake-animation]="hasLoginError()">

    <!-- Logo section -->
    <div class="logo-section">
      <mat-icon *ngIf="showFallbackIcon(); else logoImage" class="fallback-icon">
        agriculture
      </mat-icon>
      <ng-template #logoImage>
        <img [src]="config.assets.logo" alt="Feedin Logo" (error)="onLogoError($event)" />
      </ng-template>
    </div>

    <!-- Login form -->
    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form">

      <!-- Email field -->
      <mat-form-field appearance="outline" class="full-width" (focusin)="onFocus($event)"
        (focusout)="onBlur($event); trimEmail()">
        <mat-label>{{ languageService.t()('auth.email') || 'Email' }}</mat-label>
        <input matInput formControlName="email" id="email-input" type="email" inputmode="email" autocomplete="email"
          required placeholder="name@example.com">
        <mat-icon matPrefix>alternate_email</mat-icon>

        <!-- Clear Button -->
        <button mat-icon-button matSuffix *ngIf="loginForm.get('email')?.value && !loginForm.get('email')?.disabled"
          (click)="clearEmail()" type="button" tabindex="-1" class="clear-button"
          [attr.aria-label]="languageService.t()('auth.clearEmail') || 'Clear email'">
          <mat-icon>close</mat-icon>
        </button>

        <mat-error *ngIf="hasError('email')">
          {{ getErrorMessage('email') }}
        </mat-error>
      </mat-form-field>

      <!-- Password field -->
      <mat-form-field appearance="outline" class="full-width" (focusin)="onFocus($event)" (focusout)="onBlur($event)">
        <mat-label>{{ languageService.t()('auth.password') || 'Password' }}</mat-label>
        <input matInput id="password-input" formControlName="password" [type]="hidePassword() ? 'password' : 'text'"
          autocomplete="current-password" required placeholder="Enter your password" (keydown)="checkCapsLock($event)"
          (keyup)="checkCapsLock($event)">
        <mat-icon matPrefix>lock_outline</mat-icon>
        <button mat-icon-button matSuffix type="button" (click)="togglePasswordVisibility()"
          [attr.aria-label]="hidePassword() ? (languageService.t()('auth.showPassword') || 'Show password') : (languageService.t()('auth.hidePassword') || 'Hide password')">
          <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="hasError('password')">
          {{ getErrorMessage('password') }}
        </mat-error>
        <mat-hint *ngIf="capsLockOn()" class="caps-warning" align="end">
          <mat-icon inline>warning</mat-icon> Caps Lock is ON
        </mat-hint>
      </mat-form-field>

      <!-- Options row -->
      <div class="options-row">
        <mat-checkbox formControlName="rememberMe" color="primary">
          {{ languageService.t()('auth.rememberMe') || 'Remember Me' }}
        </mat-checkbox>
        <a routerLink="/forgot-password" class="forgot-password-link">
          {{ languageService.t()('auth.forgotPassword') || 'Forgot Password?' }}
        </a>
      </div>

      <!-- Submit button -->
      <button mat-raised-button color="primary" type="submit" class="login-button full-width">
        <span *ngIf="!isLoading()">
          {{ languageService.t()('auth.loginButton') || 'Log In' }}
        </span>
        <mat-progress-spinner *ngIf="isLoading()" [diameter]="24" mode="indeterminate">
        </mat-progress-spinner>
      </button>
    </form>

    <!-- Register prompt -->
    <div class="register-prompt">
      {{ languageService.t()('auth.noAccount') || "Don't have an account?" }}
      <a routerLink="/register">
        {{ languageService.t()('auth.requestAccess') || 'Request Access' }}
      </a>
    </div>

  </mat-card>
</div>